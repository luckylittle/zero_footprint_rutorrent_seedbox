---
# tasks file for ansible-role-zero-footprint-ruT-seedbox

- name: REBOOT | Enable required services, part 1
  ansible.builtin.set_fact:
    autobrr_service: "autobrr@{{ ansible_user }}"
  tags:
    - reboot

- name: REBOOT | Enable required services, part 2
  ansible.builtin.systemd:
    state: stopped
    enabled: true
    daemon_reload: true
    name: "{{ item }}"
  become: true
  loop:
    - "{{ autobrr_service }}"
    - "fail2ban"
    - "lighttpd"
    - "php-fpm"
    - "rtorrent"
    - "vsftpd"
  tags:
    - reboot

- name: REBOOT | Reboot a machine
  ansible.builtin.reboot:
    reboot_timeout: 1200
  become: true
  when: require_reboot
  tags:
    - reboot

- name: REBOOT | Empty audit.log after the reboot (cannot be done before that)
  community.general.filesize:
    path: "/var/log/audit/audit.log"
    size: 0B
  become: true
  tags:
    - reboot
